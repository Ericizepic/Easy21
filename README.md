# Easy21

Solution to problem in David Silver's RL course. https://www.davidsilver.uk/wp-content/uploads/2020/03/Easy21-Johannes.pdf

Game to be solved is a modifed version of blackjack played with the following rules:

• The game is played with an infinite deck of cards (i.e. cards are sampled
with replacement)
• Each draw from the deck results in a value between 1 and 10 (uniformly
distributed) with a colour of red (probability 1/3) or black (probability
2/3).
• There are no aces or picture (face) cards in this game
• At the start of the game both the player and the dealer draw one black
card (fully observed)
• Each turn the player may either stick or hit
• If the player hits then she draws another card from the deck
• If the player sticks she receives no further cards
• The values of the player’s cards are added (black cards) or subtracted (red
cards)
• If the player’s sum exceeds 21, or becomes less than 1, then she “goes
bust” and loses the game (reward -1)
• If the player sticks then the dealer starts taking turns. The dealer always
sticks on any sum of 17 or greater, and hits otherwise. If the dealer goes
bust, then the player wins; otherwise, the outcome – win (reward +1),
lose (reward -1), or draw (reward 0) – is the player with the largest sum.


A model-free monte-carlo controlled reinforcement learning algorithm was deployed on an environment following the rules of easy21. The model used a look up table to determine the best possible action at each of the 21 x 10 different states the player can find themselves in.

Tested on a small batch of 10^6 episodes, the following values were found for each of the following states

(1, 1) 11307 hit -0.20169930229085875 -0.3333333333333333
(1, 2) 11610 stick -1.0 0.2776294254457735
(1, 3) 11813 stick -0.3333333333333333 0.18475867908552007
(1, 4) 11704 hit -0.29547864374177274 -1.0
(1, 5) 11684 stick -4.163336342344337e-17 0.11118725372622904
(1, 6) 11210 hit -0.3171819832170598 -1.0
(1, 7) 13381 hit -0.4251826830110031 -1.0
(1, 8) 12297 stick -0.8333333333333334 -0.13562769506142783
(1, 9) 12847 stick -1.0 -0.22139187295656232
(1, 10) 10730 hit -0.5712544241581792 -1.0
(2, 1) 11598 hit -0.14044045040446412 -0.33333333333333337
(2, 2) 11610 stick -0.24324324324324328 0.25896483193640285
(2, 3) 11900 stick -1.0 0.20766450962265684
(2, 4) 12232 stick -1.0 0.16163845965170415
(2, 5) 11605 stick -0.3333333333333333 0.09946560937769375
(2, 6) 12315 stick -1.0 0.06837745655351629
(2, 7) 14577 stick -1.0 -0.026207464324917693
(2, 8) 11816 hit -0.40694170862391 -0.6666666666666666
(2, 9) 12372 hit -0.44280329329910817 -1.0
(2, 10) 11182 hit -0.5148044251650674 -1.0
(3, 1) 12063 hit -0.08887444052546521 -1.0
(3, 2) 11552 stick -1.0 0.25651458748160494
(3, 3) 11745 hit -0.15582873291801583 -1.0
(3, 4) 12580 stick -0.3333333333333333 0.1390633696429998
(3, 5) 11859 stick -1.0 0.11165457918704697
(3, 6) 11764 hit -0.21976007447927332 -1.0
(3, 7) 14265 hit -0.33770061588351075 -1.0
(3, 8) 12679 stick -0.3333333333333333 -0.1301672451877561
(3, 9) 12996 hit -0.40741942193578357 -1.0
(3, 10) 11422 hit -0.5048593149488821 -1.0
(4, 1) 12594 stick 0.0 0.3159148665819557
(4, 2) 11379 stick 0 0.25986466297565464
(4, 3) 12462 stick -1.0 0.19364416980980623
(4, 4) 12300 hit -0.18678425274514238 -1.0
(4, 5) 11509 hit -0.19890074570263594 -1.0
(4, 6) 12471 stick -1.0 0.05854049719326371
(4, 7) 15395 stick -1.0 -0.03494868130440438
(4, 8) 12634 stick -1.0 -0.11985433818872683
(4, 9) 13511 hit -0.3733819012724707 -1.0
(4, 10) 12425 stick -1.0 -0.3114331723027365
(5, 1) 12848 stick -1.0 0.3185957811162128
(5, 2) 11295 hit -0.017534629657595543 -0.3333333333333333
(5, 3) 12353 stick -1.0 0.2121113989637308
(5, 4) 12375 hit -0.14482057170934234 -1.0
(5, 5) 11772 hit -0.1360941074691211 -1.0
(5, 6) 11981 hit -0.15291685813374517 -1.0
(5, 7) 15473 stick -1.0 -0.023138572905894442
(5, 8) 12266 hit -0.3130057150603801 -1.0
(5, 9) 14712 stick -1.0 -0.20508463054856915
(5, 10) 12070 stick -1.0 -0.30300770569227
(6, 1) 12437 hit 0.05717252676481881 -1.0
(6, 2) 11578 hit 0.012265042563931478 -1.0
(6, 3) 12332 hit -0.073665200965405 -0.33333333333333337
(6, 4) 13510 stick -1.0 0.16070767636390537
(6, 5) 12179 hit -0.1196519730420249 -1.0
(6, 6) 13213 stick -1.0 0.06562712890772827
(6, 7) 15318 hit -0.2832798374183844 -1.0
(6, 8) 12622 hit -0.25544782873732697 -1.0
(6, 9) 14639 stick -1.0 -0.19879764995218022
(6, 10) 12355 stick -1.0 -0.2973935567427546
(7, 1) 13131 stick -0.11111111111111108 0.3173296753543664
(7, 2) 12397 stick -1.0 0.2594385285575982
(7, 3) 12660 hit -0.01619806997542411 -1.0
(7, 4) 13674 stick -1.0 0.14824837270533175
(7, 5) 13160 stick -0.07142857142857142 0.09518732866280862
(7, 6) 13001 stick -1.0 0.06984615384615371
(7, 7) 16035 hit -0.2298714234373089 -1.0
(7, 8) 13268 hit -0.23079363166897593 -1.0
(7, 9) 14154 hit -0.29251746455431094 -1.0
(7, 10) 11961 stick -1.0 -0.30869565217391215
(8, 1) 13144 stick 0 0.3186244674376138
(8, 2) 11821 hit 0.14221800240994156 -1.0
(8, 3) 13032 hit 0.033232388310805876 -1.0
(8, 4) 13066 hit -0.06972519483516859 -1.0
(8, 5) 13100 stick -1.0 0.10939766394381253
(8, 6) 12903 stick -1.0 0.07549217175631692
(8, 7) 16193 hit -0.1650968705126334 -1.0
(8, 8) 14053 stick -1.0 -0.12738400227725646
(8, 9) 15210 stick -1.0 -0.2115194950358336
(8, 10) 12227 stick -1.0 -0.28333060690332224
(9, 1) 13261 stick 0 0.3210165145916575
(9, 2) 12740 stick -1.0 0.25629955255514525
(9, 3) 13882 stick -0.002916645383134557 0.20584329349269578
(9, 4) 14026 hit 0.01703348806399174 -1.0
(9, 5) 13181 stick -1.0 0.10743550834597897
(9, 6) 12525 hit 0.03769337123524145 -0.3333333333333333
(9, 7) 17126 hit -0.15808076250282466 -1.0
(9, 8) 14059 stick -1.0 -0.12263479869113691
(9, 9) 14743 hit -0.16404069109907032 -1.0
(9, 10) 12247 stick -0.4122448979591837 -0.29950980392156723
(10, 1) 13275 stick 0 0.32429378531073616
(10, 2) 12302 hit 0.28987178630702154 0
(10, 3) 13805 stick 0 0.1998551249547256
(10, 4) 14938 stick -1.0 0.14306755037825467
(10, 5) 12630 hit 0.09580571469317856 -1.0
(10, 6) 13486 stick -1.0 0.06918798665183527
(10, 7) 17773 hit -0.06837712214099216 -1.0
(10, 8) 13313 hit -0.012393737591830975 -1.0
(10, 9) 15004 hit -0.06666185178825872 -1.0
(10, 10) 12319 stick -1.0 -0.3036207176489699
(11, 1) 3174 stick -0.11836734693877549 0.33501736659299064
(11, 2) 3066 stick -1.0 0.24632952691680232
(11, 3) 3788 hit 0.2714415469399112 -1.0
(11, 4) 4501 stick -0.1176470588235294 0.14406779661016964
(11, 5) 3389 stick -1.0 0.11747343565525364
(11, 6) 3281 hit 0.1884169249702362 -1.0
(11, 7) 8572 hit 0.015057220140352637 -0.2
(11, 8) 4225 hit 0.08883581218961062 -1.3877787807814457e-17
(11, 9) 6149 stick -1.0 -0.20234222511385808
(11, 10) 2256 stick -1.0 -0.3232815964523279
(12, 1) 2456 stick -0.5 0.33251833740831266
(12, 2) 3118 stick 0 0.25208466966003934
(12, 3) 3902 hit 0.19926775569834485 -0.3333333333333333
(12, 4) 3866 stick 0 0.13657527159855112
(12, 5) 3495 stick -0.02173913043478258 0.1104668019715859
(12, 6) 2749 hit 0.1669628717873524 0
(12, 7) 7946 hit -0.03786983282678807 -1.0
(12, 8) 4551 stick -1.0 -0.1371428571428574
(12, 9) 5877 hit -0.03046195184411099 -1.0
(12, 10) 1475 hit -0.12142834320485893 -1.0
(13, 1) 1650 hit 0.2025433688275849 -1.0
(13, 2) 3074 stick -1.0 0.23592580540188704
(13, 3) 4061 hit 0.13803035737122288 -0.3333333333333333
(13, 4) 3820 stick -1.0 0.14480230426813306
(13, 5) 3373 hit 0.06404511786598453 -1.0
(13, 6) 2856 stick -1.0 0.05709281961471084
(13, 7) 8484 stick -1.0 -0.03807615230460924
(13, 8) 3772 stick -1.0 -0.11005038451339164
(13, 9) 5499 stick -1.0 -0.20880320116405915
(13, 10) 854 stick -1.0 -0.3130128956623677
(14, 1) 961 stick -0.5 0.2888425443169965
(14, 2) 3112 stick -1.0 0.2343297974927678
(14, 3) 3597 stick -0.3333333333333333 0.19421257651641632
(14, 4) 3711 hit -0.01834596612809197 -0.3333333333333333
(14, 5) 3425 hit -0.01896207440818084 -1.0
(14, 6) 1963 hit 0.010679493396283098 -1.0
(14, 7) 7295 hit -0.14672937452831183 -1.0
(14, 8) 3638 stick -1.0 -0.13225185592521357
(14, 9) 4598 hit -0.12333042266789201 -1.0
(14, 10) 101 hit -0.30000000000000004 -1.0
(15, 1) 947 stick 0 0.37064413938754026
(15, 2) 3042 stick -1.0 0.26931930286090033
(15, 3) 3401 hit 0.017335929721015084 -1.0
(15, 4) 3020 hit -0.07684990957819919 -1.0
(15, 5) 2947 stick -1.0 0.09775967413441948
(15, 6) 2200 stick -1.0 0.03319690768531152
(15, 7) 7366 hit -0.19800020935602872 -1.0
(15, 8) 3795 stick -1.0 -0.10859251449657349
(15, 9) 3819 hit -0.184135191286775 -1.0
(15, 10) 99 stick -1.0 -0.22448979591836726
(16, 1) 973 stick -0.5 0.29351184346035036
(16, 2) 2418 stick -1.0 0.28695652173913117
(16, 3) 3548 hit -0.07097253362346596 -1.0
(16, 4) 2295 hit -0.15300550742393254 -1.0
(16, 5) 2214 stick -0.03413217138707335 0.07544581618655687
(16, 6) 1413 stick -1.0 0.04390934844192633
(16, 7) 7810 hit -0.2764265923572204 -1.0
(16, 8) 3028 stick -1.0 -0.13313511727783262
(16, 9) 3822 hit -0.2083159451262058 -1.0
(16, 10) 93 stick -1.0 -0.40659340659340665
(17, 1) 116 stick 0 0.4482758620689654
(17, 2) 1603 stick 0 0.3399875233936367
(17, 3) 3060 stick -0.14666666666666667 0.2805237315875618
(17, 4) 2435 hit -0.20050119748640569 -1.0
(17, 5) 1240 hit -0.18962240979376768 -1.0
(17, 6) 1422 stick -1.0 0.18789584799437012
(17, 7) 7289 stick -0.2 0.1523887973640855
(17, 8) 1975 stick -1.0 0.05876393110435683
(17, 9) 4217 stick -0.11111111111111113 -0.02683448112087391
(17, 10) 98 stick -1.0 -0.04123711340206186
(18, 1) 106 hit -0.257142857142857 -1.0
(18, 2) 1608 stick -1.0 0.5158680771624141
(18, 3) 2194 stick 0 0.4872379216043756
(18, 4) 2559 stick 0 0.45291129347401393
(18, 5) 1392 stick 0 0.42169540229885066
(18, 6) 1339 stick -1.0 0.3789237668161441
(18, 7) 6085 stick 0 0.44042728019720623
(18, 8) 1142 stick 0 0.36252189141856367
(18, 9) 3120 stick -1.0 0.2670727797370949
(18, 10) 94 stick -1.0 0.20430107526881716
(19, 1) 114 stick 0.0 0.6725663716814159
(19, 2) 800 stick -1.0 0.719649561952441
(19, 3) 1283 stick 0 0.6492595479345291
(19, 4) 1798 stick -1.0 0.6410684474123534
(19, 5) 1364 stick 0 0.6231671554252195
(19, 6) 1288 stick -1.0 0.5944055944055943
(19, 7) 5064 hit -0.4299722744518482 -1.0
(19, 8) 1116 stick -0.3333333333333333 0.6603773584905652
(19, 9) 3265 stick 0 0.5687595712098003
(19, 10) 109 stick -1.0 0.3703703703703704
(20, 1) 117 stick -1.0 0.8448275862068965
(20, 2) 800 stick -1.0 0.8360450563204006
(20, 3) 1216 stick 0 0.8018092105263167
(20, 4) 744 stick -1.0 0.7981157469717364
(20, 5) 1394 stick 0 0.7582496413199423
(20, 6) 537 stick -0.16666666666666666 0.7702448210922797
(20, 7) 4148 stick -1.0 0.7757414998794311
(20, 8) 1186 stick -1.0 0.7805907172995762
(20, 9) 2198 stick 0 0.8143767060964516
(20, 10) 118 stick -1.0 0.7863247863247866
(21, 1) 116 stick -1.0 0.9739130434782609
(21, 2) 1 stick -1.0 0
(21, 3) 1304 stick 0 0.9478527607361967
(21, 4) 760 stick 0 0.9184210526315791
(21, 5) 563 stick 0 0.9431616341030193
(21, 6) 611 stick -1.0 0.9344262295081966
(21, 7) 2891 stick -1.0 0.9366782006920421
(21, 8) 300 stick 0 0.9400000000000002
(21, 9) 1257 stick 0 0.9244232299124907
(21, 10) 100 stick -1.0 0.9696969696969698


We quickly realize that it consistently recommeds sticking near big numbers > 15 and small numbers. However, we also realize that our player is always at a disadvantage. With small numbers, we risk a lose-lose situation where if we hit and recieve a negative number, we will bust first.